.. Copyright (C) 2015, Cyb3rhq, Inc.

.. meta::
  :description: Cyb3rhq indexer is a highly scalable, full-text search and analytics engine.

Cyb3rhq indexer
=============

The Cyb3rhq indexer is a highly scalable, full-text search and analytics engine. This Cyb3rhq central component indexes and stores alerts generated by the Cyb3rhq server and provides near real-time data search and analytics capabilities. The Cyb3rhq indexer can be configured as a single-node or multi-node cluster, providing scalability and high availability.

The Cyb3rhq indexer stores data as JSON documents. Each document correlates a set of keys, field names or properties, with their corresponding values which can be strings, numbers, booleans, dates, arrays of values, geolocations, or other types of data.

An index is a collection of documents that are related to each other. The documents stored in the Cyb3rhq indexer are distributed across different containers known as shards. By distributing the documents across multiple shards, and distributing those shards across multiple nodes, the Cyb3rhq indexer can ensure redundancy. This protects your system against hardware failures and increases query capacity as nodes are added to a cluster.

Cyb3rhq uses four different indices to store different event types:

.. |--| unicode:: U+02011 .. non-breaking dash
   :trim:

+---------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 
| Index                           | Description                                                                                                                                                                                                                              |
+=================================+==========================================================================================================================================================================================================================================+
| **cyb3rhq** |--| **alerts**       | Stores alerts generated by the :doc:`/getting-started/components/cyb3rhq-server`. These are created each time an event trips a rule with a high enough priority (this threshold is configurable).                                          |
+---------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 
| **cyb3rhq** |--| **archives**     | Stores all events (archive data) received by the :doc:`/getting-started/components/cyb3rhq-server`, whether or not they trip a rule.                                                                                                       |
+---------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 
| **cyb3rhq** |--| **monitoring**   | Stores data related to the :doc:`/getting-started/components/cyb3rhq-agent` status over time. It is used by the web interface to represent when individual agents are or have been ``Active``, ``Disconnected``, or ``Never connected``.   |
+---------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 
| **cyb3rhq** |--| **statistics**   | Stores data related to the :doc:`/getting-started/components/cyb3rhq-server` performance. It is used by the web interface to represent the performance statistics.                                                                         |
+---------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 

.. thumbnail:: /images/getting-started/cyb3rhq-indexer.png
   :title: Cyb3rhq indexer
   :alt: Cyb3rhq indexer
   :align: center
   :width: 80%

Example query
-------------

You can interact with the Cyb3rhq indexer cluster using the Cyb3rhq indexer REST API, which offers a lot of flexibility. You can perform searches, add or delete documents, modify indices, and more.

Here is an example of a query to Cyb3rhq indexer that returns the last lateral movement alert using SSH technique:

.. code-block:: console
   :emphasize-lines: 6,7

   GET /cyb3rhq-alerts-4.x-*/_search
   {
     "query": {
       "bool": {
         "must": [
           {"term": { "rule.mitre.tactic": "Lateral Movement" } },
           {"term": { "rule.mitre.technique": "SSH" } }
         ]
       }
     },  
     "sort": [
       { "timestamp": { "order": "desc" } }
     ],
     "size": 1
   }

Below is an extract of the query result, which is a part of the indexed alert document:

.. code-block:: json
   :class: output
   :emphasize-lines: 13,21,27
   
   {
      "timestamp" : "2022-04-24T17:24:56.110+0000",
      "agent" : {
       "ip" : "10.0.1.52",
       "name" : "Amazon",
       "id" : "001"
      },
      "data" : {
        "srcip" : "68.183.216.91",
        "srcport" : "53820"
      },
      "rule" : {
        "description" : "sshd: insecure connection attempt (scan).",
        "id" : "5706",
        "level" : 6,
        "pci_dss" : ["11.4"],
        "mitre" : {
          "technique" : [
            "SSH"
          ],
          "id" : ["T1021.004"],
          "tactic" : [
            "Lateral Movement"
         ]
        }
      },
      "full_log" : "Apr 24 17:24:55 ip-10-0-1-52 sshd[32179]: Did not receive identification string from 68.183.216.91 port 53820",
      "location" : "/var/log/secure",
      "predecoder" : {
        "hostname" : "ip-10-0-1-52",
        "program_name" : "sshd",
        "timestamp" : "Apr 24 17:24:55"
      },
      "decoder" : {
        "parent" : "sshd",
        "name" : "sshd"
      },
      "GeoLocation" : {
        "city_name" : "Frankfurt am Main",
        "country_name" : "Germany",
        "region_name" : "Hesse"
      }
   } 

The Cyb3rhq indexer is well suited for time-sensitive use cases like security analytics and infrastructure monitoring as it is a near real-time search platform. The latency from the time a document is indexed until it becomes searchable is very short, typically one second.

In addition to its speed, scalability, and resiliency, the Cyb3rhq indexer has several built-in features that make storing and searching data even more efficient, such as data rollups, alerting, anomaly detection, and index lifecycle management.
